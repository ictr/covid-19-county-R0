library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 New Confirmed Cases by County.xlsx", skip=2, col_names=T, n_max=254)
#my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
#  my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
#  my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03` + my_data$`New Cases 2020-12-27` +
#  my_data$`New Cases 2020-12-26` + my_data$`New Cases 2020-12-25` + my_data$`New Cases 2020-12-24` +
#  my_data$`New Cases 2020-12-23` + my_data$`New Cases 2020-12-22` + my_data$`New Cases 2020-12-21`) / 14)
my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03`)/7)
my_data$`New Cases 2020-12-29` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-30` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-31` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-01` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-02` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-03` = my_data$`New Cases 2020-12-28`
View(my_data)
library(stringr)
final_data = data.frame(matrix(nrow = 254, ncol = ncol(my_data)))
DATE = str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="New Cases")], pattern="(\\d+-\\d+-\\d+)")[,2]
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(final_data) = c("county", DATE)
final_data$county = my_data$County
final_data$`20200304` = my_data$`New Cases 2020-03-04`
for(i in 3:ncol(final_data)){
final_data[,i] = final_data[,i-1] + my_data[,i]
}
my_data$`20201228` =
library(reshape2)
final_data = melt(final_data)
colnames(final_data)[2:3] = c("date", "positive")
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 New Confirmed Cases by County.xlsx", skip=2, col_names=T, n_max=254)
#my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
#  my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
#  my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03` + my_data$`New Cases 2020-12-27` +
#  my_data$`New Cases 2020-12-26` + my_data$`New Cases 2020-12-25` + my_data$`New Cases 2020-12-24` +
#  my_data$`New Cases 2020-12-23` + my_data$`New Cases 2020-12-22` + my_data$`New Cases 2020-12-21`) / 14)
my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03`)/7)
my_data$`New Cases 2020-12-29` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-30` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-31` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-01` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-02` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-03` = my_data$`New Cases 2020-12-28`
library(stringr)
final_data = data.frame(matrix(nrow = 254, ncol = ncol(my_data)))
DATE = str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="New Cases")], pattern="(\\d+-\\d+-\\d+)")[,2]
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(final_data) = c("county", DATE)
final_data$county = my_data$County
final_data$`20200304` = my_data$`New Cases 2020-03-04`
for(i in 3:ncol(final_data)){
final_data[,i] = final_data[,i-1] + my_data[,i]
}
View(final_data)
library(reshape2)
final_data = melt(final_data)
colnames(final_data)[2:3] = c("date", "positive")
write.table(x=final_data, file="covid_19_positive.txt", quote=F, sep="\t", row.names=F)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -2]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
# calculate new daily cases after specified days
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
# read new county data
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
View(daily_new_cases)
View(new_data)
View(new_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 New Confirmed Cases by County.xlsx", skip=2, col_names=T, n_max=254)
#my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
#  my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
#  my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03` + my_data$`New Cases 2020-12-27` +
#  my_data$`New Cases 2020-12-26` + my_data$`New Cases 2020-12-25` + my_data$`New Cases 2020-12-24` +
#  my_data$`New Cases 2020-12-23` + my_data$`New Cases 2020-12-22` + my_data$`New Cases 2020-12-21`) / 14)
my_data$`New Cases 2020-12-28` = round((my_data$`New Cases 2020-12-28` + my_data$`New Cases 2020-12-29` +
my_data$`New Cases 2020-12-30` + my_data$`New Cases 2020-12-31` + my_data$`New Cases 2021-01-01` +
my_data$`New Cases 2021-01-02` + my_data$`New Cases 2021-01-03`)/8)
my_data$`New Cases 2020-12-29` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-30` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2020-12-31` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-01` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-02` = my_data$`New Cases 2020-12-28`
my_data$`New Cases 2021-01-03` = my_data$`New Cases 2020-12-28`
library(stringr)
final_data = data.frame(matrix(nrow = 254, ncol = ncol(my_data)))
DATE = str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="New Cases")], pattern="(\\d+-\\d+-\\d+)")[,2]
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(final_data) = c("county", DATE)
final_data$county = my_data$County
final_data$`20200304` = my_data$`New Cases 2020-03-04`
for(i in 3:ncol(final_data)){
final_data[,i] = final_data[,i-1] + my_data[,i]
}
library(reshape2)
final_data = melt(final_data)
colnames(final_data)[2:3] = c("date", "positive")
write.table(x=final_data, file="covid_19_positive.txt", quote=F, sep="\t", row.names=F)
View(final_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -2]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
DATE[303]
View(my_data)
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
View(daily_new_cases)
View(daily_new_cases)
View(my_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,304)]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
View(my_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
my_data = my_data[, -c(2,304)]
View(my_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,305)]
View(my_data)
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,305)]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
# read new county data
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
counties = unique(my_data$county)
for(i in 1:length(counties)){
county = counties[i]
my_data_county = my_data[which(my_data$county == county),]
new_data_county = new_data[which(new_data$county == county),]
if(nrow(new_data_county) == 0){
next
} else {
for(j in 2:ncol(new_data)){
date = colnames(new_data_county[j])
current = which(colnames(my_data_county) == date)
previous = current - 1
my_data_county[1,current] =  my_data_county[1,previous] + new_data_county[1,j]
}
}
my_data[which(my_data$county == county),] = my_data_county
}
# update data after Nov.2
if((ncol(my_data)-selected_date) >= 1){
for(i in 1:(ncol(my_data)-selected_date)){
my_data[,selected_date+i] = my_data[,selected_date+i-1] + daily_new_cases[,i]
}
}
library(reshape2)
my_data = melt(my_data)
colnames(my_data)[2:3] = c("date", "positive")
write.table(x=my_data, file="covid_19_positive.txt", quote=F, sep="\t", row.names=F)
View(new_data_county)
View(new_data)
new_data$`20201229` = new_data$`20201228`
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,305)]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
# calculate new daily cases after specified days
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
# read new county data
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
new_data$`20201228` = round((new_data$`20201228`+new_data$`20201229`+new_data$`20201230`+new_data$`20201231`+
new_data$`20210101`+new_data$`20210102`+new_data$`20210103`)/7)
new_data$`20201229` = new_data$`20201228`
new_data$`20201230` = new_data$`20201228`
new_data$`20201231` = new_data$`20201228`
new_data$`20210101` = new_data$`20201228`
new_data$`20210102` = new_data$`20201228`
new_data$`20210103` = new_data$`20201228`
counties = unique(my_data$county)
for(i in 1:length(counties)){
county = counties[i]
my_data_county = my_data[which(my_data$county == county),]
new_data_county = new_data[which(new_data$county == county),]
if(nrow(new_data_county) == 0){
next
} else {
for(j in 2:ncol(new_data)){
date = colnames(new_data_county[j])
current = which(colnames(my_data_county) == date)
previous = current - 1
my_data_county[1,current] =  my_data_county[1,previous] + new_data_county[1,j]
}
}
my_data[which(my_data$county == county),] = my_data_county
}
# update data after Nov.2
if((ncol(my_data)-selected_date) >= 1){
for(i in 1:(ncol(my_data)-selected_date)){
my_data[,selected_date+i] = my_data[,selected_date+i-1] + daily_new_cases[,i]
}
}
library(reshape2)
my_data = melt(my_data)
colnames(my_data)[2:3] = c("date", "positive")
write.table(x=my_data, file="covid_19_positive.txt", quote=F, sep="\t", row.names=F)
View(new_data)
DATE
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,305)]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
View(my_data)
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
View(new_data)
View(my_data)
gap = (my_data[303] - my_data[297])/7
View(gap)
gap = round((my_data[303] - my_data[297])/7)
gap = round((my_data[,303] - my_data[,297])/7)
gap = round((my_data[,303] - my_data[,297])/7)
for(i in 297:ncol(my_data)){
my_data[,i] = my_data[,i-1] + gap
}
View(my_data)
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
# read new county data
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
new_data$`20201228` = round((new_data$`20201228`+new_data$`20201229`+new_data$`20201230`+new_data$`20201231`+
new_data$`20210101`+new_data$`20210102`+new_data$`20210103`)/7)
new_data$`20201229` = new_data$`20201228`
new_data$`20201230` = new_data$`20201228`
new_data$`20201231` = new_data$`20201228`
new_data$`20210101` = new_data$`20201228`
new_data$`20210102` = new_data$`20201228`
new_data$`20210103` = new_data$`20201228`
counties = unique(my_data$county)
for(i in 1:length(counties)){
county = counties[i]
my_data_county = my_data[which(my_data$county == county),]
new_data_county = new_data[which(new_data$county == county),]
if(nrow(new_data_county) == 0){
next
} else {
for(j in 2:ncol(new_data)){
date = colnames(new_data_county[j])
current = which(colnames(my_data_county) == date)
previous = current - 1
my_data_county[1,current] =  my_data_county[1,previous] + new_data_county[1,j]
}
}
my_data[which(my_data$county == county),] = my_data_county
}
# update data after Nov.2
if((ncol(my_data)-selected_date) >= 1){
for(i in 1:(ncol(my_data)-selected_date)){
my_data[,selected_date+i] = my_data[,selected_date+i-1] + daily_new_cases[,i]
}
}
View(my_data)
191133-188832
rm(list=ls())
library("readxl")
#setwd("/usr/share/httpd/covid-19-county-R0/TSHS_CaseCountData/")
my_data = read_excel("Texas COVID-19 Case Count Data by County.xlsx", skip=2, col_names=T, n_max=254)
library(stringr)
#DATE = paste0("2020",gsub(x=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="Cases\r\n|Cases\r\n\r\n|-", replacement=""))
DATE = paste0("2020",str_match(string=colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE[301:(ncol(my_data)-1)] = paste0("2021",str_match(string=colnames(my_data[,302:ncol(my_data)])[grep(x=colnames(my_data[,302:ncol(my_data)]), pattern="Cases")], pattern="(\\d+-\\d+)")[,2])
DATE = gsub(x = DATE, pattern = "-", replacement = "")
colnames(my_data)[grep(x=colnames(my_data), pattern="Cases")] = DATE
my_data = my_data[, -c(2,305)]
colnames(my_data)[1] = "county"
my_data = as.data.frame(my_data)
gap = round((my_data[,303] - my_data[,297])/7)
for(i in 297:ncol(my_data)){
my_data[,i] = my_data[,i-1] + gap
}
# calculate new daily cases after specified days
selected_date = which(colnames(my_data) == "20210103")
## daily new cases dataframe
if((ncol(my_data)-selected_date) >= 1){
daily_new_cases = data.frame(matrix(nrow = 254, ncol = (ncol(my_data) - selected_date)))
colnames(daily_new_cases) = colnames(my_data)[(selected_date+1):ncol(my_data)]
for(i in 1:(ncol(my_data)-selected_date)){
daily_new_cases[,i] = my_data[,selected_date+i] - my_data[,selected_date+i-1]
}
}
# read new county data
new_data = read_excel("DSHS New County Data.xlsx", col_names=T, n_max=9)
new_data_date = seq(20200901,20200930,1)
new_data_date_oct = seq(20201001,20201031,1)
new_data_date_nov = seq(20201101,20201130,1)
new_data_date_dec = seq(20201201,20201231,1)
new_data_date_jan = seq(20210101,20210103,1)
new_data_date = append(new_data_date, new_data_date_oct)
new_data_date = append(new_data_date, new_data_date_nov)
new_data_date = append(new_data_date, new_data_date_dec)
new_data_date = append(new_data_date, new_data_date_jan)
colnames(new_data) = c("county", new_data_date)
new_data = as.data.frame(new_data)
new_data$`20201227` = round((new_data$`20201227`+new_data$`20201228`+new_data$`20201229`+new_data$`20201230`+new_data$`20201231`+
new_data$`20210101`+new_data$`20210102`+new_data$`20210103`)/8)
new_data$`20201228` = new_data$`20201227`
new_data$`20201229` = new_data$`20201227`
new_data$`20201230` = new_data$`20201227`
new_data$`20201231` = new_data$`20201227`
new_data$`20210101` = new_data$`20201227`
new_data$`20210102` = new_data$`20201227`
new_data$`20210103` = new_data$`20201227`
counties = unique(my_data$county)
for(i in 1:length(counties)){
county = counties[i]
my_data_county = my_data[which(my_data$county == county),]
new_data_county = new_data[which(new_data$county == county),]
if(nrow(new_data_county) == 0){
next
} else {
for(j in 2:ncol(new_data)){
date = colnames(new_data_county[j])
current = which(colnames(my_data_county) == date)
previous = current - 1
my_data_county[1,current] =  my_data_county[1,previous] + new_data_county[1,j]
}
}
my_data[which(my_data$county == county),] = my_data_county
}
# update data after Nov.2
if((ncol(my_data)-selected_date) >= 1){
for(i in 1:(ncol(my_data)-selected_date)){
my_data[,selected_date+i] = my_data[,selected_date+i-1] + daily_new_cases[,i]
}
}
View(my_data)
library(reshape2)
my_data = melt(my_data)
colnames(my_data)[2:3] = c("date", "positive")
write.table(x=my_data, file="covid_19_positive.txt", quote=F, sep="\t", row.names=F)
